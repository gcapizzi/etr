<html>
    <head>
        <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
    </head>
    <body>
        <a id="maps-link">Google Maps</a>
        <script src="https://cdn.jsdelivr.net/npm/marked@14/marked.min.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/mustache@4/mustache.min.js"></script>
        <script id="tpl" type="x-tmpl-mustache">
            <h1><a href="article.html?id={{ articleId }}">{{ articleTitle }}</a></h1>
            <h2>{{ restaurantName }}</h2>
            <p>{{{ restaurantDesc }}}</p>
        </script>
        <script>
            let params = new URLSearchParams(document.location.search);
            let placeId = params.get("place_id");

            const mapsLink = document.getElementById("maps-link");
            mapsLink.setAttribute("href", `https://www.google.com/maps/search/?api=1&query=x&query_place_id=${placeId}`);

            fetch('articles.json')
                .then((response) => response.json())
                .then((articles) => {
                    Object.values(articles).forEach((article) => {
                        article.restaurants.forEach((restaurant) => {
                            if (restaurant.place_id === placeId) {
                                const template = document.getElementById('tpl').innerHTML;
                                const rendered = Mustache.render(template, {
                                    articleId: article.id,
                                    articleTitle: article.title,
                                    restaurantName: restaurant.name,
                                    restaurantDesc: marked.parse(restaurant.description)
                                });
                                document.body.insertAdjacentHTML("beforeend", rendered);
                            }
                        })
                    })
                });
        </script>
    </body>
</html>
